# Completion configuration (compinit is called in zprofile)

# Build fpath based on platform and available directories
typeset -U fpath
[[ -d ~/.zsh/functions ]] && fpath=(~/.zsh/functions $fpath)

# macOS Homebrew completion paths
if [[ $PLATFORM == "macos" ]]; then
  [[ -d /opt/homebrew/completions/zsh ]] && fpath=(/opt/homebrew/completions/zsh $fpath)
  [[ -d /opt/homebrew/share/zsh-completions ]] && fpath=(/opt/homebrew/share/zsh-completions $fpath)
  [[ -d /opt/homebrew/share/zsh/site-functions ]] && fpath=(/opt/homebrew/share/zsh/site-functions $fpath)
fi

# Linux Homebrew completion paths (if installed)
if [[ $PLATFORM == "linux" || $PLATFORM == "wsl" ]]; then
  [[ -d /home/linuxbrew/.linuxbrew/share/zsh/site-functions ]] && fpath=(/home/linuxbrew/.linuxbrew/share/zsh/site-functions $fpath)
fi

# Common completion paths
[[ -d /usr/local/share/zsh-completions ]] && fpath=(/usr/local/share/zsh-completions $fpath)
[[ -d /usr/local/share/zsh/site-functions ]] && fpath=(/usr/local/share/zsh/site-functions $fpath)
[[ -d /usr/share/zsh/site-functions ]] && fpath=(/usr/share/zsh/site-functions $fpath)
[[ -d ~/.zsh/completion ]] && fpath=(~/.zsh/completion $fpath)

zstyle ':completion:*' completer _expand _complete _ignored
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' menu select
zstyle :compinstall filename ~/.zshrc

# Autoload custom functions
if [[ -d ~/.zsh/functions ]]; then
  for f in ~/.zsh/functions/*; do
    [[ -f "$f" ]] && autoload -Uz ${f##*/}
  done
fi
